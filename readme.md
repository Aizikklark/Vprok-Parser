
# Скрипт для парсинга продуктов с использованием Puppeteer

Этот проект представляет собой JavaScript-скрипт для Node.js, который с помощью библиотеки Puppeteer автоматически выбирает регион на сайте [vprok.ru](https://www.vprok.ru), делает полноразмерный скриншот страницы товара, сохраняет в файл `screenshot.jpg`, а также получает информацию о цене товара, рейтинге и количестве отзывов и сохраняет эти данные в файл `product.txt`.

## Требования

- Node.js (версия 12 или выше)
- npm (Node Package Manager)
- Puppeteer библиотека

## Установка

1. Убедитесь, что Node.js и npm установлены на вашем компьютере.
2. Установите необходимые зависимости, выполнив следующую команду в терминале:

   ```
   npm install puppeteer
   ```

## Использование

Скрипт принимает два аргумента: URL-адрес страницы товара и название региона. 

Пример команды для запуска:

```
node index.js https://www.vprok.ru/product/domik-v-derevne-dom-v-der-moloko-ster-3-2-950g--309202 "Санкт-Петербург и область"
```

### Аргументы

- `URL`: Ссылка на страницу товара, которую необходимо обработать.
- `Регион`: Название региона, который необходимо выбрать на сайте (например, "Москва и область", "Санкт-Петербург и область").

## Результат

После выполнения скрипта будут созданы следующие файлы:

1. **screenshot.jpg**: Полноразмерный скриншот страницы товара.
2. **product.txt**: Текстовый файл с характеристиками товара, содержащий:
   - `price`: Текущая цена товара.
   - `priceOld`: Старая цена товара (если есть).
   - `rating`: Рейтинг товара.
   - `reviewCount`: Количество отзывов на товар.

## Описание работы

1. **Запуск браузера и открытие страницы**:
   - Скрипт запускает браузер с помощью Puppeteer и открывает новую страницу.
   - Переходит на указанный URL и ожидает загрузки содержимого страницы.

2. **Ожидание отображения кнопки региона**:
   - Ожидает, пока кнопка выбора региона ("Москва и область") станет видимой и полностью отрисуется.

3. **Проверка текущего региона**:
   - Извлекает текущий выбранный регион с помощью `page.evaluate()` и сравнивает его с требуемым регионом.

4. **Выбор региона**:
   - Если текущий регион не совпадает с требуемым, скрипт кликает по кнопке выбора региона и выбирает нужный регион из списка.

5. **Скрытие элементов интерфейса**:
   - Скрывает всплывающие элементы, которые могут помешать чистому скриншоту, такие как окна с предложениями или уведомлениями.

6. **Прокрутка страницы**:
   - Скрипт выполняет прокрутку страницы до конца, чтобы убедиться, что все элементы загружены, а затем возвращается наверх страницы.

7. **Скриншот страницы**:
   - Делает скриншот страницы и сохраняет его как `screenshot.jpg`.

8. **Извлечение данных о продукте**:
   - Извлекает данные о цене, старой цене, рейтинге и количестве отзывов продукта.

9. **Сохранение данных**:
   - Сохраняет извлеченные данные в файл `product.txt`.

10. **Закрытие браузера**:
    - Закрывает браузер и завершает работу скрипта.

## Примечания

- Скрипт автоматически скрывает некоторые всплывающие элементы и прокручивает страницу до конца, чтобы создать чистый скриншот.
- Если регион уже выбран, скрипт не будет пытаться выбрать его снова.

## Отладка

Проект содержит несколько полезных команд для запуска и проверки кода. Эти команды можно использовать через `npm run <команда>`:

- **`start`**: запускает `index2.js` с помощью Node.js. Используется для выполнения скрипта автоматического парсинга множества страниц и регионов.
  ```
  npm run start
  ```

- **`format`**: запускает [Prettier] для форматирования кода в файлах `index.js` и `index2.js`. Эта команда автоматически исправляет стиль кода и форматирование.
  ```
  npm run format
  ```

- **`check`**: запускает [ESLint] для проверки файлов `index.js` и `index2.js` на наличие ошибок кода и несоответствия стилю кодирования. ESLint помогает находить и исправлять проблемы в коде.
  ```
  npm run check
  ```

## Автор

- **Василий** - (https://github.com/Aizikklark)